{"version":3,"file":"VDataTableVirtual.mjs","names":["VTable","VDataTableHeaders","VDataTableRows","createHeaders","makeDataTableHeaderProps","makeDataTableItemProps","useDataTableItems","makeDataTableExpandProps","provideExpanded","createSort","makeDataTableSortProps","provideSort","useSortedItems","createGroupBy","makeDataTableGroupProps","provideGroupBy","useGroupedItems","makeDataTableSelectProps","provideSelection","makeDataTableVirtualProps","useVirtual","useOptions","makeFilterProps","useFilter","provideDefaults","computed","ref","toRef","convertToUnit","genericComponent","useRender","makeVDataTableProps","VDataTableVirtual","name","props","search","String","emits","value","event","setup","emit","slots","groupBy","sortBy","multiSort","mustSort","columns","showSelect","showExpand","items","filterKeys","map","c","key","filteredItems","sortByWithGroups","opened","extractRows","sortedItems","flatItems","allRows","containerRef","paddingTop","paddingBottom","startIndex","stopIndex","itemHeight","handleScroll","visibleItems","slice","page","itemsPerPage","hideNoData","noDataText","height","fixedHeader","top","wrapper","border","length","bottom"],"sources":["../../../src/labs/VDataTable/VDataTableVirtual.tsx"],"sourcesContent":["// Components\nimport { VTable } from '@/components/VTable'\nimport { VDataTableHeaders } from './VDataTableHeaders'\nimport { VDataTableRows } from './VDataTableRows'\n\n// Composables\nimport { createHeaders, makeDataTableHeaderProps } from './composables/headers'\nimport { makeDataTableItemProps, useDataTableItems } from './composables/items'\nimport { makeDataTableExpandProps, provideExpanded } from './composables/expand'\nimport { createSort, makeDataTableSortProps, provideSort, useSortedItems } from './composables/sort'\nimport { createGroupBy, makeDataTableGroupProps, provideGroupBy, useGroupedItems } from './composables/group'\nimport { makeDataTableSelectProps, provideSelection } from './composables/select'\nimport { makeDataTableVirtualProps, useVirtual } from './composables/virtual'\nimport { useOptions } from './composables/options'\nimport { makeFilterProps, useFilter } from '@/composables/filter'\nimport { provideDefaults } from '@/composables/defaults'\n\n// Utlities\nimport { computed, ref, toRef } from 'vue'\nimport { convertToUnit, genericComponent, useRender } from '@/util'\nimport { makeVDataTableProps } from './VDataTable'\n\n// Types\nimport type { DataTableItem } from './types'\nimport type { VDataTableRowsSlots } from './VDataTableRows'\n\nexport type VDataTableVirtualSlots = VDataTableRowsSlots & {\n  top: []\n  headers: []\n  bottom: []\n}\n\nexport const VDataTableVirtual = genericComponent<VDataTableVirtualSlots>()({\n  name: 'VDataTableVirtual',\n\n  props: {\n    search: String,\n\n    ...makeVDataTableProps(),\n    ...makeVDataTableProps(),\n    ...makeDataTableGroupProps(),\n    ...makeDataTableExpandProps(),\n    ...makeDataTableHeaderProps(),\n    ...makeDataTableItemProps(),\n    ...makeDataTableSelectProps(),\n    ...makeDataTableSortProps(),\n    ...makeDataTableVirtualProps(),\n    ...makeFilterProps(),\n  },\n\n  emits: {\n    'update:modelValue': (value: any[]) => true,\n    'update:sortBy': (value: any) => true,\n    'update:options': (value: any) => true,\n    'update:groupBy': (value: any) => true,\n    'update:expanded': (value: any) => true,\n    'click:row': (event: Event, value: { item: DataTableItem }) => true,\n  },\n\n  setup (props, { emit, slots }) {\n    const { groupBy } = createGroupBy(props)\n    const { sortBy, multiSort, mustSort } = createSort(props)\n\n    const { columns } = createHeaders(props, {\n      groupBy,\n      showSelect: toRef(props, 'showSelect'),\n      showExpand: toRef(props, 'showExpand'),\n    })\n    const { items } = useDataTableItems(props, columns)\n\n    const filterKeys = computed(() => columns.value.map(c => 'columns.' + c.key))\n    const search = toRef(props, 'search')\n    const { filteredItems } = useFilter<DataTableItem>(props, items, search, { filterKeys })\n\n    provideSort({ sortBy, multiSort, mustSort })\n    const { sortByWithGroups, opened, extractRows } = provideGroupBy({ groupBy, sortBy })\n\n    const { sortedItems } = useSortedItems(filteredItems, sortByWithGroups, columns)\n    const { flatItems } = useGroupedItems(sortedItems, groupBy, opened)\n\n    const allRows = computed(() => extractRows(flatItems.value))\n\n    provideSelection(props, allRows)\n    provideExpanded(props)\n\n    const {\n      containerRef,\n      paddingTop,\n      paddingBottom,\n      startIndex,\n      stopIndex,\n      itemHeight,\n      handleScroll,\n    } = useVirtual(props, flatItems)\n\n    const visibleItems = computed(() => {\n      return flatItems.value.slice(startIndex.value, stopIndex.value)\n    })\n\n    useOptions({\n      sortBy,\n      page: ref(1),\n      itemsPerPage: ref(-1),\n      groupBy,\n      search,\n    })\n\n    provideDefaults({\n      VDataTableRows: {\n        hideNoData: toRef(props, 'hideNoData'),\n        noDataText: toRef(props, 'noDataText'),\n      },\n    })\n\n    useRender(() => (\n      <VTable\n        class=\"v-data-table\"\n        style={{\n          '--v-table-row-height': convertToUnit(itemHeight.value),\n        }}\n        height={ props.height }\n        fixedHeader={ props.fixedHeader }\n      >\n        {{\n          top: slots.top,\n          wrapper: () => (\n            <div\n              ref={ containerRef }\n              onScroll={ handleScroll }\n              class=\"v-table__wrapper\"\n              style={{\n                height: convertToUnit(props.height),\n              }}\n            >\n              <table>\n                <thead>\n                  <VDataTableHeaders\n                    sticky={ props.fixedHeader }\n                    multiSort={ props.multiSort }\n                    v-slots={ slots }\n                  />\n                </thead>\n                <tbody>\n                  <tr style={{ height: convertToUnit(paddingTop.value), border: 0 }}>\n                    <td colspan={ columns.value.length } style={{ height: convertToUnit(paddingTop.value), border: 0 }}></td>\n                  </tr>\n\n                  <VDataTableRows\n                    items={ visibleItems.value }\n                    onClick:row={ (event, value) => emit('click:row', event, value) }\n                    v-slots={ slots }\n                  />\n\n                  <tr style={{ height: convertToUnit(paddingBottom.value), border: 0 }}>\n                    <td colspan={ columns.value.length } style={{ height: convertToUnit(paddingBottom.value), border: 0 }}></td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          ),\n          bottom: slots.bottom,\n        }}\n      </VTable>\n    ))\n  },\n})\n\nexport type VDataTableVirtual = InstanceType<typeof VDataTableVirtual>\n"],"mappings":"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"}